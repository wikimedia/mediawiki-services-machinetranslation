version: v4
base: docker-registry.wikimedia.org/python3-build-bullseye
# Should allow downloading models. So we need write access on file system
runs: {insecurely: true}
lives:
  in: /app

variants:
  build:
    copies: [local]
    apt: { packages: [git, build-essential, wget, unzip] }
    python: { version: python3, requirements: [requirements.txt]}
  test:
    includes: [build]
    entrypoint: ["python3", "-m", "pytest"]
  production:
    includes: [build]
    apt: { packages: [ca-certificates] }
    entrypoint: ["bash", "server.sh"]
